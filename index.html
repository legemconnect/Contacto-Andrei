<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Andrei Dima | Perfil Legal & Tech</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Perfil profesional de Andrei Dima. Derecho & IA.">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/mapdata/custom/europe.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

    <style>
        /* --- 1. VARIABLES & RESET (SISTEMA DE TEMAS) --- */
        :root {
            /* TEMA OSCURO (POR DEFECTO) */
            --bg-deep: #0f172a;       /* Fondo principal oscuro */
            --bg-card: #1e293b;       /* Fondo tarjetas */
            --bg-element: #28364a;    /* Fondo botones/inputs */
            --accent-primary: #38bdf8; /* Azul cyan */
            --text-main: #f1f5f9;     /* Texto blanco */
            --text-muted: #94a3b8;    /* Texto gris */
            --border-color: #334155;  /* Bordes */
            --radius-lg: 24px;
            --radius-sm: 12px;
            --font-main: 'Inter', sans-serif;
            --font-display: 'Space Grotesk', sans-serif;
            
            /* Colores espec칤ficos del Mapa (Oscuro) */
            --map-null: #334155;      
            --map-border: #1e293b;
            --map-hover: #38bdf8;

            /* Chatbot Variables */
            --chat-bg-user: #38bdf8;
            --chat-text-user: #ffffff;
            --chat-bg-bot: #28364a;
        }

        /* TEMA CLARO (OFFICE MODE) */
        body.light-mode {
            --bg-deep: #f8fafc;       /* Blanco gris치ceo */
            --bg-card: #ffffff;       /* Blanco puro */
            --bg-element: #f1f5f9;    /* Gris muy claro */
            --accent-primary: #0ea5e9; /* Azul m치s s칩lido */
            --text-main: #1e293b;     /* Texto oscuro */
            --text-muted: #64748b;    /* Gris medio */
            --border-color: #cbd5e1;  /* Bordes suaves */
            
            /* Colores espec칤ficos del Mapa (Claro) */
            --map-null: #e2e8f0;      
            --map-border: #94a3b8;
            --map-hover: #0ea5e9;

            /* Chatbot Variables Claro */
            --chat-bg-user: #0ea5e9;
            --chat-text-user: #ffffff;
            --chat-bg-bot: #f1f5f9;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-main);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
            opacity: 1;
        }

        body.fading { opacity: 0.8; }

        /* --- 2. LAYOUT --- */
        .main-wrapper {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: 320px 1fr; 
            gap: 30px;
            align-items: start;
        }

        /* --- 3. SIDEBAR --- */
        .sidebar {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 30px;
            text-align: center;
            position: sticky;
            top: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .profile-img-wrapper {
            width: 140px;
            height: 140px;
            margin: 0 auto;
            border-radius: 20px; 
            padding: 6px;
            background: var(--accent-primary); 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-img-wrapper img {
            width: 100%;
            height: 100%; object-fit: contain;
            border-radius: 14px; background: #fff; border: 3px solid var(--bg-card);
            transition: border-color 0.3s ease;
        }

        .sidebar h3 {
            font-family: var(--font-display);
            font-size: 1.6rem; margin-bottom: 5px; color: var(--text-main);
        }

        .tagline {
            font-size: 0.85rem;
            color: var(--accent-primary); text-transform: uppercase;
            letter-spacing: 1.5px; font-weight: 700; margin-bottom: 5px;
        }

        .social-links { display: flex; justify-content: center; gap: 15px; }
        .social-links a {
            width: 42px;
            height: 42px; display: flex; align-items: center; justify-content: center;
            border-radius: 50%; background: var(--bg-element); color: var(--text-main);
            transition: all 0.2s; text-decoration: none;
            font-size: 1.2rem; border: 1px solid var(--border-color);
        }
        .social-links a:hover {
            background: var(--accent-primary);
            color: #fff; transform: translateY(-2px); border-color: var(--accent-primary);
        }

        /* --- 4. CONTENT AREA --- */
        .content-area { display: flex; flex-direction: column; gap: 30px; }

        .section-header {
            display: flex;
            align-items: center; gap: 12px; margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color); padding-bottom: 10px;
        }
        .section-header i { color: var(--accent-primary); font-size: 1.2rem; }
        .section-header h3 { font-family: var(--font-display); font-size: 1.4rem; margin: 0; }

        .clean-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm); padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        ul { list-style: none; padding: 0; display: grid; gap: 12px; }
        .link-card {
            display: flex;
            align-items: center; padding: 15px;
            background-color: var(--bg-element); 
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-decoration: none; color: var(--text-main);
            transition: all 0.2s; font-weight: 500;
        }
        .link-card:hover {
            background-color: var(--bg-card);
            transform: translateX(5px); color: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        .link-card i { margin-right: 15px; color: var(--accent-primary); width: 20px; text-align: center; }

        /* Quiz */
        .andi-quiz-term strong {
            display: block;
            font-size: 2rem; font-family: var(--font-display);
            color: var(--text-main); margin: 10px 0;
            transition: color 0.3s;
        }
        .andi-quiz-answer {
            background: #064e3b;
            color: #6ee7b7; padding: 10px;
            border-radius: 8px; margin: 20px 0; display: none; font-weight: bold;
        }
        .andi-quiz-answer.visible { display: block; animation: fadeIn 0.3s; }
        .andi-quiz-controls button {
            padding: 10px 20px;
            border-radius: 6px; border: none;
            font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        #andi-btn-reveal { background: var(--accent-primary); color: #fff; }
        
        /* Mapa */
        .map-toggle {
            width: 100%;
            padding: 15px; background: var(--bg-element); color: var(--text-main);
            border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            transition: background-color 0.3s ease;
        }
        .map-toggle:hover { background-color: var(--bg-card); border-color: var(--accent-primary); }

        .map-content {
            max-height: 0;
            overflow: hidden; transition: max-height 0.5s ease; opacity: 0;
        }
        .map-content.expanded { max-height: 600px; opacity: 1; margin-top: 20px; }
        #map-container { height: 500px; width: 100%; border-radius: 8px; background: var(--bg-element); transition: background-color 0.3s ease;}

        /* --- ESTILOS TOOLTIP --- */
        .custom-tooltip {
            padding: 12px;
            text-align: center; color: #333;
            width: 300px; 
            transition: width 0.3s ease;
        }
        .custom-tooltip.wide { width: 480px; }
        .tooltip-gallery {
            display: grid;
            grid-template-columns: 1fr; gap: 6px; margin-bottom: 8px;
        }
        .custom-tooltip.wide .tooltip-gallery { grid-template-columns: 1fr 1fr; }
        .tooltip-gallery img {
            width: 100%;
            height: 180px; 
            object-fit: cover;
            border-radius: 6px; background-color: #ddd;
        }

        /* Formulario */
        form label { font-size: 0.9rem; color: var(--text-muted); margin-top: 15px; display: block; }
        input, textarea {
            width: 100%;
            padding: 12px; margin-top: 5px;
            background: var(--bg-deep);
            border: 1px solid var(--border-color);
            border-radius: 6px; color: var(--text-main); font-family: inherit;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus { outline:none; border-color: var(--accent-primary); }

        button[type="submit"] {
            width: 100%;
            padding: 14px; margin-top: 25px;
            background: var(--accent-primary); color: #fff;
            border: none; font-weight: 700; border-radius: 6px; cursor: pointer;
            transition: all 0.3s ease;
        }
        button[type="submit"].loading {
            background: var(--text-muted);
            color: var(--bg-deep); cursor: not-allowed;
        }

        /* CONTROLES */
        .controls-wrapper {
            margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;
        }
        .control-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-muted); padding: 6px 16px; border-radius: 20px; cursor: pointer;
            font-size: 0.95rem; display: flex; align-items: center; gap: 6px;
            transition: all 0.2s ease;
        }
        .control-btn:hover { border-color: var(--text-muted); color: var(--text-main); }
        .control-btn.active { background: var(--accent-primary); color: #fff; border-color: var(--accent-primary); font-weight: bold; }
        
        #theme-toggle i { font-size: 1rem; }

        footer { margin-top: 50px; text-align: center; font-size: 0.8rem; color: var(--text-muted); padding-bottom: 20px;}
        .confirmation, .error { 
            padding: 15px;
            border-radius: 6px; margin-top: 15px; display: none; text-align: center; 
            animation: slideIn 0.4s ease-out;
        }
        .confirmation { background: #064e3b; color: #6ee7b7; border: 1px solid #047857; }
        .error { background: #7f1d1d; color: #fca5a5; border: 1px solid #b91c1c; }

        /* ==================== ESTILOS CHATBOT ==================== */
        .chatbot-toggler {
            position: fixed;
            bottom: 30px;
            right: 35px;
            height: 60px;
            width: 60px;
            background: var(--accent-primary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 2px solid var(--bg-deep);
        }
        .chatbot-toggler span {
            color: #fff;
            position: absolute;
            font-size: 1.5rem;
        }
        .chatbot-toggler span:last-child,
        .chatbot-toggler.show-chat span:first-child  {
            opacity: 0;
        }
        .chatbot-toggler.show-chat span:last-child {
            opacity: 1;
        }
        .chatbot-container {
            position: fixed;
            bottom: 100px;
            right: 35px;
            width: 380px;
            background: var(--bg-card);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.5);
            transform-origin: bottom right;
            transition: all 0.1s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }
        .chatbot-container.show-chat {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }
        .chatbot-header {
            background: var(--accent-primary);
            padding: 15px 0;
            text-align: center;
            position: relative;
        }
        .chatbot-header h2 {
            color: #fff;
            font-size: 1.2rem;
            margin: 0;
            font-family: var(--font-display);
        }
        .chatbot-header p {
            color: #e0f2fe;
            font-size: 0.8rem;
            margin: 0;
        }
        .chatbot-header span {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #fff;
            cursor: pointer;
            display: none; /* Oculto en desktop, visible si quieres en mobile */
        }
        .chatbox {
            height: 400px;
            overflow-y: auto;
            padding: 15px 20px 70px;
            background: var(--bg-element);
        }
        .chatbox .chat {
            display: flex;
            list-style: none;
            margin: 15px 0;
        }
        .chatbox .incoming span {
            width: 32px;
            height: 32px;
            color: #fff;
            background: var(--accent-primary);
            text-align: center;
            line-height: 32px;
            border-radius: 4px;
            align-self: flex-end;
            margin: 0 10px 7px 0;
            flex-shrink: 0;
        }
        .chatbox .outgoing {
            justify-content: flex-end;
            margin: 20px 0;
        }
        .chatbox .chat p {
            max-width: 85%;
            font-size: 0.95rem;
            padding: 12px 16px;
            border-radius: 10px 10px 0 10px;
            color: #fff;
            background: var(--accent-primary);
            white-space: pre-wrap;
            margin: 0;
        }
        .chatbox .incoming p {
            border-radius: 10px 10px 10px 0;
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--border-color);
        }
        .chat-input {
            position: absolute;
            bottom: 0;
            width: 100%;
            display: flex;
            gap: 5px;
            background: var(--bg-card);
            padding: 8px 20px;
            border-top: 1px solid var(--border-color);
        }
        .chat-input textarea {
            height: 45px;
            width: 100%;
            border: none;
            outline: none;
            resize: none;
            background: transparent;
            font-size: 0.95rem;
            color: var(--text-main);
            padding: 12px 0 12px 0;
            margin: 0;
        }
        .chat-input span {
            align-self: flex-end;
            color: var(--accent-primary);
            cursor: pointer;
            height: 45px;
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            visibility: hidden;
        }
        .chat-input textarea:valid ~ span {
            visibility: visible;
        }

        /* Markdown Styles en chat */
        .chatbox p strong { font-weight: bold; color: var(--accent-primary); }
        .chatbox p ul { padding-left: 20px; margin: 5px 0; display: block; }
        .chatbox p li { list-style: disc; margin-bottom: 5px; }

        @media (max-width: 490px) {
            .chatbot-container {
                right: 0;
                bottom: 0;
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
            .chatbot-container.show-chat {
                transform: scale(1);
            }
            .chatbot-header span { display: block; }
            .chatbot-toggler { right: 20px; bottom: 20px; }
        }

        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        @keyframes slideIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <aside class="sidebar">
            <div class="controls-wrapper">
                <button class="control-btn lang-btn active" data-lang="es">游쀯릖 ES</button>
                <button class="control-btn lang-btn" data-lang="en">游섫릖 EN</button>
                <button class="control-btn" id="theme-toggle" title="Cambiar Tema">
                    <i class="fa-solid fa-moon"></i>
                </button>
            </div>

            <div class="profile-img-wrapper">
                <img src="img/Uji.png" alt="Logo UJI" onerror="this.src='https://via.placeholder.com/150/38bdf8/ffffff?text=UJI'">
            </div>
            
            <div class="profile-text">
                <div class="tagline">Law & Tech</div>
                <h3 id="about-title">Andrei Dima</h3>
                <p class="bio-text" id="about-text1" style="color:var(--text-muted); font-size:0.9rem;">Estudiante de Derecho con una profunda pasi칩n por la tecnolog칤a, la inteligencia artificial y el asesoramiento jur칤dico empresarial.</p>
                <p class="bio-text" id="about-text2" style="color:var(--text-muted); font-size:0.85rem;">Este sitio sirve como mi portal profesional, donde puedes encontrar mis publicaciones, trabajos y una forma directa de contactarme.</p>
            </div>

            <div class="social-links">
                <a href="https://www.linkedin.com/in/andidima/" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin-in"></i></a>
                <a href="https://github.com/legemconnect/Contacto-Andrei" target="_blank" title="GitHub"><i class="fa-brands fa-github"></i></a>
                <a href="mailto:andreidimaavram@gmail.com" title="Email"><i class="fa-solid fa-envelope"></i></a>
            </div>
        </aside>

        <main class="content-area">
            <!-- CHATBOT BUTTON & MODAL -->
            <button class="chatbot-toggler">
                <span class="fa-solid fa-robot"></span>
                <span class="fa-solid fa-xmark"></span>
            </button>
            <div class="chatbot-container">
                <header class="chatbot-header">
                    <h2>Legal AI Assistant</h2>
                    <p>Powered by Gemini AI</p>
                    <span class="close-btn fa-solid fa-xmark"></span>
                </header>
                <ul class="chatbox">
                    <li class="chat incoming">
                        <span class="fa-solid fa-robot"></span>
                        <p>춰Hola! Soy el asistente virtual de Andrei. 쯊ienes alguna duda sobre Derecho, los trabajos publicados o la web? 丘뒲잺</p>
                    </li>
                </ul>
                <div class="chat-input">
                    <textarea placeholder="Escribe tu pregunta..." required></textarea>
                    <span id="send-btn" class="fa-solid fa-paper-plane"></span>
                </div>
            </div>

            <section id="mis-informes" class="clean-card">
                <div class="section-header">
                    <i class="fa-solid fa-book-open"></i>
                    <h3 id="reports-title">Trabajos Acad칠micos</h3>
                </div>
                <p id="reports-subtitle" style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.9rem;">Accede a mis trabajos acad칠micos y proyectos.</p>
                <ul>
                    <li>
                        <a href="reports/Fondos NewGen.pdf" target="_blank" class="link-card">
                            <i class="fa-solid fa-earth-europe"></i>
                            <span id="report1">Fondos NewGen UE: An치lisis Jur칤dico</span>
                        </a>
                    </li>
                    <li>
                        <a href="reports/Comentario STS.pdf" target="_blank" class="link-card">
                            <i class="fa-solid fa-scale-balanced"></i>
                            <span id="report2">Comentario: Sentencia del Tribunal Supremo (191/2021)</span>
                        </a>
                    </li>
                    <li>
                        <a href="reports/Comentario STS 2.pdf" target="_blank" class="link-card">
                            <i class="fa-solid fa-scale-balanced"></i>
                            <span id="report3">Comentario: Sentencia del Tribunal Supremo (3079/2016)</span>
                        </a>
                    </li>
                    <li>
                        <a href="reports/Jueces Robot.pdf" target="_blank" class="link-card">
                            <i class="fa-solid fa-microchip"></i>
                            <span id="report4">An치lisis Jur칤dico de los Jueces Robot</span>
                        </a>
                    </li>
                    <li>
                        <a href="reports/Transporte Maritimo.pdf" target="_blank" class="link-card">
                            <i class="fa-solid fa-ship"></i>
                            <span id="report5">Presentaci칩n sobre Transporte Mar칤timo</span>
                        </a>
                    </li>
                    <li>
                        <a href="reports/Responsabilidad Extracontractual.pdf" target="_blank" class="link-card">
                            <i class="fa-solid fa-globe"></i>
                            <span id="report6">An치lisis Pr치ctico de Responsabilidad Extracontractual Internacional</span>
                        </a>
                    </li>
                </ul>
            </section>

            <section id="andi-quiz-section" class="clean-card" style="text-align:center;">
                <div class="section-header" style="justify-content: center; border:none; flex-direction: column; gap:5px;">
                    <h3 id="andi-quiz-title"><i class="fa-solid fa-brain" style="color:var(--accent-primary); margin-right:8px;"></i> Quiz Traducci칩n Jur칤dica</h3>
                    <p id="quiz-subtitle" style="font-size:0.8rem; color:var(--text-muted); margin:0;">Adivina la traducci칩n correcta</p>
                </div>
                <div class="andi-quiz-term">
                    <span style="color: var(--text-muted); font-size:0.8rem; text-transform: uppercase;">T칠rmino / Term</span>
                    <strong id="andi-quiz-term-text">Abogado</strong>
                </div>
                <div class="andi-quiz-answer" id="andi-quiz-answer">Lawyer</div>
                <div class="andi-quiz-controls">
                    <button id="andi-btn-reveal" type="button">Revelar</button>
                    <button id="andi-btn-next" class="secondary" type="button" style="background:transparent; border:1px solid var(--border-color); color:var(--text-main); margin-left:10px;">Siguiente</button>
                </div>
            </section>

            <section id="mis-viajes">
                <div class="section-header">
                    <i class="fa-solid fa-earth-americas"></i>
                    <h3 id="travel-title">Mis Viajes</h3>
                </div>
                <button class="map-toggle" id="mapToggle">
                    <span id="map-toggle-text">Desplegar Mapa Interactivo</span>
                    <i class="fa-solid fa-chevron-down"></i>
                </button>
                <div class="map-content" id="mapContent">
                    <div id="map-container"></div>
                </div>
            </section>
            
            <section id="formulario-contacto" class="clean-card">
                <div class="section-header">
                    <i class="fa-solid fa-gavel"></i>
                    <h3 id="contact-title">Consulta Legal</h3>
                </div>
                <p id="contact-subtitle" style="color: var(--text-muted); font-size: 0.9rem;">Formulario para revisi칩n preliminar.</p>
                <form id="legal-form">
                    <label for="name" id="label-name">Nombre:</label>
                    <input type="text" id="name" name="name" required>
                    <label for="email" id="label-email">Correo electr칩nico:</label>
                    <input type="email" id="email" name="email" required>
                    <label for="phone" id="label-phone">Tel칠fono:</label>
                    <input type="tel" id="phone" name="phone" required>
                    <label for="description" id="label-description">Descripci칩n del problema:</label>
                    <textarea id="description" name="description" required rows="4"></textarea>
                    
                    <label for="jurisdiction" id="label-jurisdiction">Ubicaci칩n actual (Ciudad, Pa칤s):</label>
                    <input type="text" id="jurisdiction" name="jurisdiction" placeholder="Ej: Madrid, Espa침a" required>
                    
                    <button type="submit"><span id="btn-submit">Enviar Consulta</span></button>
                </form>
                <div id="confirmation" class="confirmation"><span id="confirmation-text">춰Enviado correctamente!</span></div>
                <div id="error" class="error"><span id="error-text">Error al enviar.</span></div>
                <div id="response" style="display:none; margin-top: 20px; background: var(--bg-element); padding: 15px; border-radius: 6px; border-left: 3px solid var(--accent-primary);"></div>
            </section>

            <footer>
                <p><strong id="disclaimer-title" style="color: #fca5a5;">Descargo de responsabilidad:</strong> <span id="disclaimer-text">La informaci칩n proporcionada en este sitio es solo para fines acad칠micos y no constituye asesoramiento legal. Consulte siempre con un abogado calificado para problemas legales espec칤ficos.</span></p>
                <p id="footer-contact">Contacto: andreidimaavram@gmail.com</p>
            </footer>
        </main>
    </div>

    <script>
        /* ================= DATOS MAPA (TEXTOS ACTUALIZADOS) ================= */
        const visitedCountriesData = [
            { code: 'es', name: {es: 'Espa침a', en: 'Spain'}, text: {es: 'Mi hogar y base de mi educaci칩n.', en: 'My home and the base of my education.'}, imgs: ['img/paises/espana_1.jpg','img/paises/espana_2.jpg','img/paises/espana_3.jpg','img/paises/espana_4.jpg'] },
            { code: 'fr', name: {es: 'Francia', en: 'France'}, text: {es: 'Viaje a Francia.', en: 'Trip to France.'}, imgs: ['img/paises/francia_1.jpg'] },
            { code: 'ie', name: {es: 'Irlanda', en: 'Ireland'}, text: {es: 'Experiencia inolvidable en Dubl칤n.', en: 'Unforgettable experience in Dublin.'}, imgs: ['img/paises/irlanda_1.jpg','img/paises/irlanda_2.jpg','img/paises/irlanda_3.jpg'] },
            { code: 'ch', name: {es: 'Suiza', en: 'Switzerland'}, text: {es: 'Alpes suizos.', en: 'Swiss Alps.'}, imgs: ['img/paises/suiza_1.jpg'] },
            { code: 'it', name: {es: 'Italia', en: 'Italy'}, text: {es: 'Arte, historia y gastronom칤a inigualable.', en: 'Art, history, and unrivaled cuisine.'}, imgs: ['img/paises/italia_1.jpg'] },
            { code: 'de', name: {es: 'Alemania', en: 'Germany'}, text: {es: 'Coraz칩n de Europa: Historia y Modernidad.', en: 'Heart of Europe: History and Modernity.'}, imgs: ['img/paises/alemania_1.jpg'] },
            { code: 'at', name: {es: 'Austria', en: 'Austria'}, text: {es: 'Viena: Arte, m칰sica y palacios imperiales.', en: 'Vienna: Art, music, and imperial palaces.'}, imgs: ['img/paises/austria_1.jpg','img/paises/austria_2.jpg'] },
            { code: 'cz', name: {es: 'Rep. Checa', en: 'Czech Rep.'}, text: {es: 'Brno: mi segunda casa.', en: 'Brno: my second home.'}, imgs: ['img/paises/chequia_1.jpg','img/paises/chequia_2.jpg','img/paises/chequia_3.jpg','img/paises/chequia_4.jpg'] },
            { code: 'si', name: {es: 'Eslovenia', en: 'Slovenia'}, text: {es: 'Joyas ocultas y naturaleza verde.', en: 'Hidden gems and green nature.'}, imgs: ['img/paises/eslovenia_1.jpg'] },
            { code: 'hu', name: {es: 'Hungr칤a', en: 'Hungary'}, text: {es: 'Budapest: La perla del Danubio.', en: 'Budapest: Pearl of the Danube.'}, imgs: ['img/paises/hungria_1.jpg'] },
            { code: 'ro', name: {es: 'Ruman칤a', en: 'Romania'}, text: {es: 'Mis ra칤ces y familia.', en: 'My roots and family.'}, imgs: ['img/paises/rumania_1.jpg'] },
            { code: 'ad', name: {es: 'Andorra', en: 'Andorra'}, text: {es: 'Nieve, monta침as y paisajes 칰nicos.', en: 'Snow, mountains, and unique landscapes.'}, imgs: [] },
            { code: 'mc', name: {es: 'M칩naco', en: 'Monaco'}, text: {es: 'Lujo y belleza en la Costa Azul.', en: 'Luxury and beauty on the French Riviera.'}, imgs: [] }
        ];

        /* ================= TRADUCCIONES ================= */
        const translations = {
            es: {
                'about-title': 'Andrei Dima', 
                'about-text1': 'Estudiante de Derecho con una profunda pasi칩n por la tecnolog칤a, la inteligencia artificial y el asesoramiento jur칤dico empresarial.',
                'about-text2': 'Este sitio sirve como mi portal profesional, donde puedes encontrar mis publicaciones, trabajos y una forma directa de contactarme.',
                'reports-title': 'Trabajos Acad칠micos', 
                'reports-subtitle': 'Accede a mis trabajos acad칠micos y proyectos.', 
                'report1': 'Fondos NewGen UE: An치lisis Jur칤dico', 
                'report2': 'Comentario: Sentencia del Tribunal Supremo (191/2021)', 
                'report3': 'Comentario: Sentencia del Tribunal Supremo (3079/2016)',
                'report4': 'An치lisis Jur칤dico de los Jueces Robot', 
                'report5': 'Presentaci칩n sobre Transporte Mar칤timo',
                'report6': 'An치lisis Pr치ctico de Responsabilidad Extracontractual Internacional',
                'travel-title': 'Mis Viajes', 'map-show': 'Desplegar Mapa', 'map-hide': 'Ocultar Mapa', 
                'contact-title': 'Consulta Legal', 'contact-subtitle': 'Formulario para revisi칩n preliminar.', 'label-name': 'Nombre:', 'label-email': 'Correo electr칩nico:', 'label-phone': 'Tel칠fono:', 'label-description': 'Descripci칩n del problema:', 
                'label-jurisdiction': 'Ubicaci칩n actual (Ciudad, Pa칤s):',
                'btn-submit': 'Enviar Consulta', 'confirmation-text': '춰Enviado correctamente!', 'error-text': 'Error al enviar.', 
                'response-thanks': 'Gracias por compartir su problema legal.', 
                'response-general': 'Este servicio proporciona orientaci칩n general y no sustituye el asesoramiento profesional.', 
                'response-resources': 'Puede consultar estos recursos:', 
                'disclaimer-title': 'Descargo de responsabilidad:', 
                'disclaimer-text': 'La informaci칩n proporcionada en este sitio es solo para fines acad칠micos y no constituye asesoramiento legal. Consulte siempre con un abogado calificado para problemas legales espec칤ficos.', 
                'andi-quiz-title': 'Quiz Traducci칩n Jur칤dica', 
                'quiz-subtitle': 'Adivina la traducci칩n correcta', 'quiz-reveal': 'Revelar', 'quiz-hide': 'Ocultar', 'quiz-next': 'Siguiente'
            },
            en: {
                'about-title': 'Andrei Dima', 
                'about-text1': 'Law student with a deep passion for technology, artificial intelligence, and corporate legal consulting.',
                'about-text2': 'This site serves as my professional portal, where you can find my publications, work, and a direct way to contact me.',
                'reports-title': 'Academic Papers', 
                'reports-subtitle': 'Access my academic papers and projects.', 
                'report1': 'Analysis of EU NewGen Funds', 
                'report2': 'Commentary: Supreme Court Ruling (191/2021)', 
                'report3': 'Commentary: Supreme Court Ruling (3079/2016)',
                'report4': 'Legal Analysis of Robot Judges', 
                'report5': 'Presentation on Maritime Transport',
                'report6': 'Practical Analysis of International Non-Contractual Liability',
                'travel-title': 'My Travels', 'map-show': 'Show Map', 'map-hide': 'Hide Map', 
                'contact-title': 'Legal Consultation', 'contact-subtitle': 'Preliminary review form.', 'label-name': 'Name:', 'label-email': 'Email:', 'label-phone': 'Phone:', 'label-description': 'Issue Description:', 
                'label-jurisdiction': 'Current Location (City, Country):',
                'btn-submit': 'Submit Inquiry', 'confirmation-text': 'Sent successfully!', 'error-text': 'Error sending.', 
                'response-thanks': 'Thank you for sharing your legal issue.', 
                'response-general': 'This service provides general guidance and does not replace professional advice.', 
                'response-resources': 'You can consult these resources:', 
                'disclaimer-title': 'Disclaimer:', 'disclaimer-text': 'The information provided on this site is for academic purposes only and does not constitute legal advice. Always consult with a qualified attorney for specific legal issues.', 
                'andi-quiz-title': 'Legal Translation Quiz', 
                'quiz-subtitle': 'Guess the correct translation', 'quiz-reveal': 'Reveal', 'quiz-hide': 'Hide', 'quiz-next': 'Next'
            }
        };

        /* ================= QUIZ 50 T칄RMINOS ================= */
        const flashcards = [
            { es:{q:'Abogado', a:'Lawyer'}, en:{q:'Lawyer', a:'Abogado'} },
            { es:{q:'Contrato', a:'Contract'}, en:{q:'Contract', a:'Contrato'} },
            { es:{q:'Jurisdicci칩n', a:'Jurisdiction'}, en:{q:'Jurisdiction', a:'Jurisdicci칩n'} },
            { es:{q:'Demandante', a:'Plaintiff'}, en:{q:'Plaintiff', a:'Demandante'} },
            { es:{q:'Demandado', a:'Defendant'}, en:{q:'Defendant', a:'Demandado'} },
            { es:{q:'Demanda', a:'Lawsuit/Claim'}, en:{q:'Lawsuit', a:'Demanda'} },
            { es:{q:'Veredicto', a:'Verdict'}, en:{q:'Verdict', a:'Veredicto'} },
            { es:{q:'Juez', a:'Judge'}, en:{q:'Judge', a:'Juez'} },
            { es:{q:'Tribunal', a:'Court'}, en:{q:'Court', a:'Tribunal'} },
            { es:{q:'Fiscal', a:'Prosecutor'}, en:{q:'Prosecutor', a:'Fiscal'} },
            { es:{q:'Propiedad Intelectual', a:'IP'}, en:{q:'IP', a:'Propiedad Intelectual'} },
            { es:{q:'Testigo', a:'Witness'}, en:{q:'Witness', a:'Testigo'} },
            { es:{q:'Juramento', a:'Oath'}, en:{q:'Oath', a:'Juramento'} },
            { es:{q:'Fianza', a:'Bail'}, en:{q:'Bail', a:'Fianza'} },
            { es:{q:'Delito grave', a:'Felony'}, en:{q:'Felony', a:'Delito grave'} },
            { es:{q:'Delito leve', a:'Misdemeanor'}, en:{q:'Misdemeanor', a:'Delito leve'} },
            { es:{q:'Apelaci칩n', a:'Appeal'}, en:{q:'Appeal', a:'Apelaci칩n'} },
            { es:{q:'Sentencia', a:'Sentence/Judgment'}, en:{q:'Judgment', a:'Sentencia'} },
            { es:{q:'Custodia', a:'Custody'}, en:{q:'Custody', a:'Custodia'} },
            { es:{q:'Negligencia', a:'Negligence'}, en:{q:'Negligence', a:'Negligencia'} },
            { es:{q:'Da침os y perjuicios', a:'Damages'}, en:{q:'Damages', a:'Da침os y perjuicios'} },
            { es:{q:'Orden judicial', a:'Warrant/Order'}, en:{q:'Warrant', a:'Orden judicial'} },
            { es:{q:'Patente', a:'Patent'}, en:{q:'Patent', a:'Patente'} },
            { es:{q:'Marca registrada', a:'Trademark'}, en:{q:'Trademark', a:'Marca registrada'} },
            { es:{q:'Derechos de autor', a:'Copyright'}, en:{q:'Copyright', a:'Derechos de autor'} },
            { es:{q:'Acuerdo', a:'Settlement'}, en:{q:'Settlement', a:'Acuerdo'} },
            { es:{q:'Responsabilidad', a:'Liability'}, en:{q:'Liability', a:'Responsabilidad'} },
            { es:{q:'Cl치usula', a:'Clause'}, en:{q:'Clause', a:'Cl치usula'} },
            { es:{q:'Incumplimiento', a:'Breach'}, en:{q:'Breach', a:'Incumplimiento'} },
            { es:{q:'Testamento', a:'Will'}, en:{q:'Will', a:'Testamento'} },
            { es:{q:'Herencia', a:'Inheritance'}, en:{q:'Inheritance', a:'Herencia'} },
            { es:{q:'Arrendamiento', a:'Lease'}, en:{q:'Lease', a:'Arrendamiento'} },
            { es:{q:'Inquilino', a:'Tenant'}, en:{q:'Tenant', a:'Inquilino'} },
            { es:{q:'Desahucio', a:'Eviction'}, en:{q:'Eviction', a:'Desahucio'} },
            { es:{q:'Quiebra', a:'Bankruptcy'}, en:{q:'Bankruptcy', a:'Quiebra'} },
            { es:{q:'Fusi칩n', a:'Merger'}, en:{q:'Merger', a:'Fusi칩n'} },
            { es:{q:'Adquisici칩n', a:'Acquisition'}, en:{q:'Acquisition', a:'Adquisici칩n'} },
            { es:{q:'Estatuto', a:'Statute'}, en:{q:'Statute', a:'Estatuto'} },
            { es:{q:'Reglamento', a:'Regulation'}, en:{q:'Regulation', a:'Reglamento'} },
            { es:{q:'Litigio', a:'Litigation'}, en:{q:'Litigation', a:'Litigio'} },
            { es:{q:'Arbitraje', a:'Arbitration'}, en:{q:'Arbitration', a:'Arbitraje'} },
            { es:{q:'Mediaci칩n', a:'Mediation'}, en:{q:'Mediation', a:'Mediaci칩n'} },
            { es:{q:'Declaraci칩n', a:'Affidavit'}, en:{q:'Affidavit', a:'Declaraci칩n jurada'} },
            { es:{q:'Citaci칩n', a:'Subpoena'}, en:{q:'Subpoena', a:'Citaci칩n'} },
            { es:{q:'Veredicto de culpabilidad', a:'Guilty verdict'}, en:{q:'Guilty verdict', a:'Culpable'} },
            { es:{q:'Absoluci칩n', a:'Acquittal'}, en:{q:'Acquittal', a:'Absoluci칩n'} },
            { es:{q:'Pena de muerte', a:'Death penalty'}, en:{q:'Death penalty', a:'Pena de muerte'} },
            { es:{q:'Homicidio', a:'Homicide'}, en:{q:'Homicide', a:'Homicidio'} },
            { es:{q:'Fraude', a:'Fraud'}, en:{q:'Fraud', a:'Fraude'} },
            { es:{q:'Soborno', a:'Bribery'}, en:{q:'Bribery', a:'Soborno'} }
        ];

        /* ================= LOGICA PRINCIPAL ================= */
        document.addEventListener('DOMContentLoaded', function() {
            
            // 1. FIX DE SEGURIDAD HIGHCHARTS
            try {
                if (typeof Highcharts !== 'undefined' && Highcharts.AST) {
                    if (Highcharts.AST.allowedTags.indexOf('img') === -1) Highcharts.AST.allowedTags.push('img');
                    if (Highcharts.AST.allowedAttributes.indexOf('src') === -1) Highcharts.AST.allowedAttributes.push('src');
                }
                if (typeof Highcharts !== 'undefined') {
                    Highcharts.setOptions({ accessibility: { enabled: false } });
                }
            } catch (e) { console.error("Error Highcharts Config:", e); }

            // 2. VARIABLES GLOBALES
            let currentLanguage = localStorage.getItem('preferredLanguage') || 'es';
            let currentTheme = localStorage.getItem('preferredTheme') || 'dark';
            let currentQuizIndex = 0;
            let mapChart = null;
            let animTimeouts = [];

            // 3. REFERENCIAS DOM
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeIcon = themeToggleBtn ? themeToggleBtn.querySelector('i') : null;
            const quizTermEl = document.getElementById('andi-quiz-term-text');
            const quizAnswerEl = document.getElementById('andi-quiz-answer');
            const quizRevealBtn = document.getElementById('andi-btn-reveal');
            const quizNextBtn = document.getElementById('andi-btn-next');
            const mapToggle = document.getElementById('mapToggle');
            const mapContent = document.getElementById('mapContent');

            // 4. FUNCIONES
            function applyTheme(theme) {
                if (theme === 'light') {
                    document.body.classList.add('light-mode');
                    if(themeIcon) { themeIcon.classList.remove('fa-moon'); themeIcon.classList.add('fa-sun'); }
                } else {
                    document.body.classList.remove('light-mode');
                    if(themeIcon) { themeIcon.classList.remove('fa-sun'); themeIcon.classList.add('fa-moon'); }
                }
                if(mapChart) {
                    setTimeout(() => {
                        const style = getComputedStyle(document.documentElement);
                        const newBorder = style.getPropertyValue('--map-border').trim();
                        const newNull = style.getPropertyValue('--map-null').trim();
                        
                        mapChart.update({
                            series: [{
                                borderColor: newBorder,
                                nullColor: newNull
                            }]
                        });
                    }, 50);
                }
            }

            function renderQuizCard() {
                const card = flashcards[currentQuizIndex];
                if (!card) return;
                const data = card[currentLanguage];
                if(quizTermEl) quizTermEl.textContent = data.q;
                if(quizAnswerEl) {
                    quizAnswerEl.textContent = data.a;
                    quizAnswerEl.classList.remove('visible');
                }
                if(quizRevealBtn) quizRevealBtn.textContent = translations[currentLanguage]['quiz-reveal'];
            }

            function setLanguage(lang) {
                document.body.classList.add('fading');
                setTimeout(() => {
                    currentLanguage = lang;
                    localStorage.setItem('preferredLanguage', lang);
                    document.documentElement.lang = lang;
                    
                    Object.keys(translations[lang]).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if(key.includes('link')) element.setAttribute('title', translations[lang][key]);
                            else if(element.tagName === 'INPUT') element.placeholder = translations[lang]['label-jurisdiction'].replace(':', '');
                            else element.textContent = translations[lang][key];
                        }
                    });

                    const jurisdictionInput = document.getElementById('jurisdiction');
                    if(jurisdictionInput) {
                        jurisdictionInput.placeholder = lang === 'es' ? 'Ej: Madrid, Espa침a' : 'E.g: Madrid, Spain';
                    }

                    document.querySelectorAll('.lang-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.lang === lang);
                    });

                    const mapToggleText = document.getElementById('map-toggle-text');
                    if(mapContent && mapContent.classList.contains('expanded')) {
                        if(mapToggleText) mapToggleText.textContent = translations[lang]['map-hide'];
                    } else {
                        if(mapToggleText) mapToggleText.textContent = translations[lang]['map-show'];
                    }

                    renderQuizCard();
                    
                    if(mapChart) {
                        mapChart.series[0].update({ name: currentLanguage === 'es' ? 'Viajes' : 'Travels' });
                        initMap();
                    }

                    document.body.classList.remove('fading');
                }, 200);
            }

            function initMap() {
                if (typeof Highcharts === 'undefined') return;
                if (mapChart) mapChart.destroy();
                
                const repoBaseUrl = 'https://legemconnect.github.io/Contacto-Andrei/';
                const style = getComputedStyle(document.documentElement);
                const borderColor = style.getPropertyValue('--map-border').trim() || '#1e293b';
                const nullColor = style.getPropertyValue('--map-null').trim() || '#334155';

                mapChart = Highcharts.mapChart('map-container', {
                    chart: { map: 'custom/europe', backgroundColor: 'transparent', animation: false },
                    title: { text: '' },
                    mapNavigation: { enabled: false },
                    exporting: { enabled: false },
                    legend: { enabled: false },
                    credits: { enabled: false },
                    tooltip: { 
                        useHTML: true,
                        backgroundColor: 'rgba(255,255,255,0.95)',
                        borderRadius: 8,
                        borderWidth: 0,
                        shadow: true,
                        padding: 0,
                        headerFormat: '',
                        formatter: function () {
                            const point = this.point;
                            const images = point.customImgs || [];
                            const lang = currentLanguage;
                            const isWideClass = images.length > 1 ? 'wide' : '';
                            let imagesHtml = '';
                            
                            if (images.length > 0) {
                                imagesHtml = '<div class="tooltip-gallery">';
                                images.forEach(img => { 
                                    let finalSrc = img;
                                    if (!img.startsWith('http')) {
                                        finalSrc = repoBaseUrl + img;
                                    }
                                    imagesHtml += `<img src="${finalSrc}" alt="Foto viaje" style="display:block;">`; 
                                });
                                imagesHtml += '</div>';
                            }
                            
                            const name = point.customName[lang];
                            const text = point.customText[lang];
                            return `
                            <div class="custom-tooltip ${isWideClass}">
                                ${imagesHtml}
                                <h4 style="margin: 8px 0 5px 0; color:#2874A6; font-size:1.25em;">${name}</h4>
                                <p style="font-size:0.9em; margin:0; line-height:1.4;">${text || ''}</p>
                            </div>`;
                        }
                    },
                    series: [{
                        data: [],
                        name: currentLanguage === 'es' ? 'Viajes' : 'Travels',
                        joinBy: 'hc-key',
                        borderColor: borderColor, 
                        borderWidth: 1,
                        nullColor: nullColor, 
                        states: { hover: { color: getComputedStyle(document.documentElement).getPropertyValue('--map-hover').trim() || '#38bdf8' } }
                    }]
                });
            }

            function playMapAnimation() {
                animTimeouts.forEach(t => clearTimeout(t));
                animTimeouts = [];
                let currentData = [];
                const hoverColor = getComputedStyle(document.documentElement).getPropertyValue('--map-hover').trim() || '#38bdf8';
                
                visitedCountriesData.forEach((country, i) => {
                    const t = setTimeout(() => {
                        currentData.push({ 
                            'hc-key': country.code, 
                            value: 1, 
                            color: hoverColor, 
                            customName: country.name,
                            customText: country.text,
                            customImgs: country.imgs 
                        });
                        if(mapChart) {
                            mapChart.series[0].setData([...currentData], false);
                            mapChart.redraw(false);
                        }
                    }, i * 400); 
                    animTimeouts.push(t);
                });
            }

            // 5. EVENT LISTENERS
            if(themeToggleBtn) {
                themeToggleBtn.addEventListener('click', () => {
                    currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    localStorage.setItem('preferredTheme', currentTheme);
                    applyTheme(currentTheme);
                });
            }

            document.querySelectorAll('.lang-btn').forEach(btn => btn.addEventListener('click', () => setLanguage(btn.dataset.lang)));

            if(quizRevealBtn) {
                quizRevealBtn.addEventListener('click', () => {
                    if(!quizAnswerEl) return;
                    const isVisible = quizAnswerEl.classList.contains('visible');
                    if (isVisible) {
                        quizAnswerEl.classList.remove('visible');
                        quizRevealBtn.textContent = translations[currentLanguage]['quiz-reveal'];
                    } else {
                        quizAnswerEl.classList.add('visible');
                        quizRevealBtn.textContent = translations[currentLanguage]['quiz-hide'];
                    }
                });
            }

            if(quizNextBtn) {
                quizNextBtn.addEventListener('click', () => {
                    currentQuizIndex = (currentQuizIndex + 1) % flashcards.length;
                    renderQuizCard();
                });
            }

            if(mapToggle) {
                mapToggle.addEventListener('click', function() {
                    mapContent.classList.toggle('expanded');
                    const icon = this.querySelector('i');
                    const mapToggleText = document.getElementById('map-toggle-text');
                    
                    if (mapContent.classList.contains('expanded')) {
                        if(mapToggleText) mapToggleText.textContent = translations[currentLanguage]['map-hide'];
                        if(icon) icon.style.transform = 'rotate(180deg)';
                        setTimeout(() => { initMap(); playMapAnimation(); }, 300);
                    } else {
                        if(mapToggleText) mapToggleText.textContent = translations[currentLanguage]['map-show'];
                        if(icon) icon.style.transform = 'rotate(0deg)';
                        animTimeouts.forEach(t => clearTimeout(t));
                    }
                });
            }
            
            // EmailJS init
            (function(){ emailjs.init('hz9CzCgK-LggHycqt'); })();
            
            const legalForm = document.getElementById('legal-form');
            if(legalForm) {
                legalForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    const btn = document.getElementById('btn-submit');
                    const originalText = btn.textContent;
                    btn.classList.add('loading');
                    btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Enviando...';
                    document.getElementById('confirmation').style.display = 'none';
                    document.getElementById('error').style.display = 'none';
                    
                    emailjs.sendForm('LegemConnect', 'template_m5tlbo5', this).then(function() {
                        document.getElementById('confirmation').style.display = 'block';
                        legalForm.reset();
                        btn.classList.remove('loading');
                        btn.innerHTML = originalText;
                        const lang = currentLanguage;
                        const responseDiv = document.getElementById('response');
                        responseDiv.innerHTML = `
                            <p><strong>${translations[lang]['response-thanks']}</strong></p>
                            <p>${translations[lang]['response-general']}</p>
                            <p>${translations[lang]['response-resources']}</p>
                            <ul style="text-align: left; margin-top: 5px;">
                                <li><a href='http://www.abogacia.es/servicios/' target='_blank' style="color:var(--accent-primary)">Abogac칤a Espa침ola</a></li>
                                <li><a href='https://justiciaoberta.gva.es/es/necessite-un-advocat-i-no-m-ho-puc-pagar/' target='_blank' style="color:var(--accent-primary)">Justicia Gratuita</a></li>
                            </ul>`;
                        responseDiv.style.display = 'block';
                    }, function(error) {
                        document.getElementById('error').style.display = 'block';
                        btn.classList.remove('loading');
                        btn.innerHTML = originalText;
                    });
                });
            }

            // ==================== LOGICA CHATBOT IA INTELIGENTE V3 ====================
            const chatbotToggler = document.querySelector(".chatbot-toggler");
            const closeBtn = document.querySelector(".close-btn");
            const chatbox = document.querySelector(".chatbox");
            const chatInput = document.querySelector(".chat-input textarea");
            const sendChatBtn = document.querySelector(".chat-input span");

            // --- 춰IMPORTANTE! SIGUE ESTOS PASOS ---
            // 1. GENERA UNA CLAVE NUEVA EN https://aistudio.google.com/app/apikey
            // 2. NO la pegues entera. P칠gala por trozos aqu칤 abajo:
            
            const parteA = "AIzaSyByuV"; 
            const parteB = "4p_RLik-E6";
            const parteC = "5ZO9BaaZK9o41-28SHU";
            
            const GOOGLE_API_KEY = parteA + parteB + parteC; 

            let userMessage = null; 
            const inputInitHeight = chatInput.scrollHeight;

            const createChatLi = (message, className) => {
                const chatLi = document.createElement("li");
                chatLi.classList.add("chat", className);
                let chatContent = className === "outgoing" ? `<p></p>` : `<span class="fa-solid fa-robot"></span><p></p>`;
                chatLi.innerHTML = chatContent;
                chatLi.querySelector("p").textContent = message;
                return chatLi;
            }

            const formatResponse = (text) => {
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\* (.*?)\n/g, '<li>$1</li>')
                    .replace(/\n/g, '<br>');
            }

            // --- FUNCI칍N DE AUTODETECCI칍N DE MODELO ---
            // Le pregunta a Google qu칠 modelos est치n disponibles para esta clave
            let autoDetectedModel = null;

            const detectBestModel = async () => {
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models?key=${GOOGLE_API_KEY}`;
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error?.message || "Error al listar modelos");
                    
                    // Buscamos si existe 'gemini-1.5-flash' o 'gemini-pro' en la lista
                    const models = data.models || [];
                    const flash = models.find(m => m.name.includes("gemini-1.5-flash"));
                    const pro = models.find(m => m.name.includes("gemini-pro"));
                    const onePointZero = models.find(m => m.name.includes("gemini-1.0-pro"));
                    
                    // Elegimos el mejor disponible
                    if (flash) return flash.name.replace("models/", "");
                    if (pro) return pro.name.replace("models/", "");
                    if (onePointZero) return onePointZero.name.replace("models/", "");
                    
                    // Si no encontramos los conocidos, cogemos el primero que sirva para generar texto
                    const fallback = models.find(m => m.supportedGenerationMethods && m.supportedGenerationMethods.includes("generateContent"));
                    if (fallback) return fallback.name.replace("models/", "");

                    throw new Error("No se encontraron modelos compatibles con generateContent");
                } catch (e) {
                    console.warn("Fallo en autodetecci칩n:", e);
                    return null; // Si falla la detecci칩n, volveremos al m칠todo manual
                }
            };

            const generateResponse = async (chatElement) => {
                const messageElement = chatElement.querySelector("p");
                messageElement.textContent = "...";

                try {
                    // 1. Detectamos el modelo si a칰n no lo tenemos
                    if (!autoDetectedModel) {
                         console.log("Detectando modelo 칩ptimo...");
                         autoDetectedModel = await detectBestModel();
                         console.log("Modelo detectado:", autoDetectedModel);
                    }

                    // 2. Si la detecci칩n fall칩, intentamos los nombres est치ndar por defecto
                    const modelToUse = autoDetectedModel || "gemini-1.5-flash";
                    
                    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${modelToUse}:generateContent?key=${GOOGLE_API_KEY}`;
                    
                    const requestOptions = {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ 
                                    text: `Eres AndreiBot, asistente legal experto.
                                    Responde dudas sobre derecho espa침ol/europeo de forma concisa. 
                                    SIEMPRE incluye: "No soy abogado, esto es informaci칩n acad칠mica".
                                    Pregunta: ${userMessage}` 
                                }]
                            }]
                        })
                    };

                    const response = await fetch(API_URL, requestOptions);
                    const data = await response.json();
                    
                    if (!response.ok) {
                        const errorMsg = data.error?.message || "Error desconocido";
                        // Si falla con el modelo detectado, reseteamos para volver a detectar la pr칩xima vez
                        autoDetectedModel = null; 
                        throw new Error(errorMsg);
                    }
                    
                    const apiResponse = data.candidates[0].content.parts[0].text;
                    messageElement.innerHTML = formatResponse(apiResponse);

                } catch (error) {
                    messageElement.textContent = "Error de conexi칩n. Verifica la clave API.";
                    messageElement.style.color = "#fca5a5";
                    console.error("Fallo chatbot:", error);
                    
                    if (error.message.includes("API_KEY_INVALID")) {
                         alert("丘멆잺 CLAVE INCORRECTA: La API Key no es v치lida. Revisa que la hayas copiado bien.");
                    } else if (error.message.includes("not found")) {
                        // Si incluso la detecci칩n fall칩 o el modelo no existe
                        alert("丘멆잺 MODELO NO ENCONTRADO: Parece que tu cuenta de Google no tiene acceso a los modelos est치ndar. Intenta crear una API Key en un proyecto nuevo de Google Cloud.");
                    } else {
                        alert(`丘멆잺 ERROR: ${error.message}`);
                    }
                } finally {
                    chatbox.scrollTo(0, chatbox.scrollHeight);
                }
            }

            const handleChat = () => {
                userMessage = chatInput.value.trim();
                if(!userMessage) return;

                if (GOOGLE_API_KEY.includes("PON_AQUI")) {
                    alert("춰ALTO! No has puesto la clave API en el c칩digo (l칤nea ~480).");
                    return;
                }

                chatInput.value = "";
                chatInput.style.height = `${inputInitHeight}px`;

                chatbox.appendChild(createChatLi(userMessage, "outgoing"));
                chatbox.scrollTo(0, chatbox.scrollHeight);

                setTimeout(() => {
                    const incomingChatLi = createChatLi("Escribiendo...", "incoming");
                    chatbox.appendChild(incomingChatLi);
                    chatbox.scrollTo(0, chatbox.scrollHeight);
                    generateResponse(incomingChatLi);
                }, 600);
            }

            chatInput.addEventListener("input", () => {
                chatInput.style.height = `${inputInitHeight}px`;
                chatInput.style.height = `${chatInput.scrollHeight}px`;
            });

            chatInput.addEventListener("keydown", (e) => {
                if(e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
                    e.preventDefault();
                    handleChat();
                }
            });

            sendChatBtn.addEventListener("click", handleChat);
            closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
            chatbotToggler.addEventListener("click", () => {
                document.querySelector(".chatbot-container").classList.toggle("show-chat");
                chatbotToggler.classList.toggle("show-chat");
            });

            // 6. INICIALIZACI칍N FINAL
            applyTheme(currentTheme);
            setLanguage(currentLanguage);
            renderQuizCard();
        });
    </script>
</body>
</html>
